<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Worker Node Status</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #e9f7ef;
        }
        .status-running-bg { background-color: #28a745; } /* Zelená pro RUNNING */
        .status-waiting-bg { background-color: #6c757d; } /* Šedá pro WAITING */
    </style>
</head>
<body>

    <div class="container mt-5">
        <h1 class="mb-4 text-success">Worker Node Status</h1>
        <div id="alertPlaceholder"></div>

        <div class="card text-white mb-3 shadow" id="mainStatusCard">
            <div class="card-header" id="workerHeader">Worker ID: Načítám...</div>
            <div class="card-body">
                <h2 class="card-title display-4" id="workerStatus">...</h2>
                <hr>
                <p class="card-text">
                    **ID Procesu:** <span id="processId">N/A</span><br>
                    **Profil:** <span id="profileId">N/A</span><br>
                    **Popis úkolu:** <span id="description">N/A</span><br>
                </p>
            </div>
        </div>

    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // POZNÁMKA: Tento endpoint musí být implementován ve Worker aplikaci.
        const API_BASE_URL = '/process-worker/api'; 
        const STATUS_ENDPOINT = '/status'; // PŘEDPOKLÁDANÝ NOVÝ ENDPOINT

        function showAlert(message, type = 'danger') {
            const alertPlaceholder = document.getElementById('alertPlaceholder');
            const wrapper = document.createElement('div');
            wrapper.innerHTML = [
                `<div class="alert alert-${type} alert-dismissible fade show" role="alert">`,
                `   <div>${message}</div>`,
                '   <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>',
                '</div>'
            ].join('');
            alertPlaceholder.append(wrapper);
        }

        /**
         * Získá aktuální stav Workeru z nově implementovaného API endpointu.
         */
        async function fetchWorkerStatus() {
            const mainCard = document.getElementById('mainStatusCard');
            const statusH2 = document.getElementById('workerStatus');
            const workerHeader = document.getElementById('workerHeader');
            const processIdSpan = document.getElementById('processId');
            const profileIdSpan = document.getElementById('profileId');
            const descriptionSpan = document.getElementById('description');

            try {
                const response = await fetch(`${API_BASE_URL}${STATUS_ENDPOINT}`);
                if (!response.ok) throw new Error(`HTTP error! status: ${response.status}`);
                const data = await response.json();

                const status = data.status || 'UNKNOWN';
                
                // Aktualizace Vzhledu
                mainCard.className = `card text-white mb-3 shadow ${status === 'RUNNING' ? 'status-running-bg' : 'status-waiting-bg'}`;
                workerHeader.textContent = `Worker ID: ${data.workerId || 'N/A'}`;

                // Aktualizace Detailů
                statusH2.textContent = status;

                if (status === 'RUNNING') {
                    processIdSpan.textContent = data.currentProcessId || 'N/A';
                    profileIdSpan.textContent = data.profileId || 'N/A';
                    descriptionSpan.textContent = data.description || 'Probíhá spuštěný proces';
                } else {
                    processIdSpan.textContent = 'Žádný';
                    profileIdSpan.textContent = 'Žádný';
                    descriptionSpan.textContent = 'Čeká na přidělení úkolu od Process Manageru';
                }

            } catch (error) {
                console.error("Chyba při načítání stavu Workeru:", error);
                mainCard.className = `card text-white bg-danger mb-3 shadow`;
                statusH2.textContent = 'NEDOSTUPNÝ (ERROR)';
                workerHeader.textContent = `Worker ID: CHYBA PŘI PŘIPOJENÍ`;
                processIdSpan.textContent = 'N/A';
                profileIdSpan.textContent = 'N/A';
                descriptionSpan.textContent = 'Nepodařilo se připojit k Worker API.';
                showAlert(`Nepodařilo se načíst stav Workeru. Chyba: ${error.message}`);
            }
        }

        /**
         * Inicializace dashboardu - spustí načítání dat a nastaví interval.
         */
        function initDashboard() {
            fetchWorkerStatus();
            
            // Periodická aktualizace každých 3 sekund
            setInterval(fetchWorkerStatus, 3000); 
        }

        // Spuštění po načtení DOM
        document.addEventListener('DOMContentLoaded', initDashboard);
    </script>

</body>
</html>